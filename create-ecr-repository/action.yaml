name: 'AWS ECR create repository'
description: 'Create repository in AWS ECR if not exist and set lifecycle policy'
branding:
  icon: 'cloud'
  color: 'orange'
inputs:
  repositoryName:
    description: 'Repository name'
    required: true
  imageTagMutability:
    description: 'Repositary imageTagMutability MUTABLE|UNMUTABLE. Default MUTABLE'
    required: true
    default: 'MUTABLE'
  tags:
    description: 'Repositary tags list. Default no tags set'
  tagStatus:
    description: 'Lifecycle tagStatus can be tagged|untagged|any. Default any'
    required: true
    default: 'tagged'
  countType:
    description: 'Lifecycle countType can be imageCountMoreThan|sinceImagePushed. Default imageCountMoreThan'
    required: true
    default: 'imageCountMoreThan'
  countNumber:
    description: 'Lifecycle countNumber. Default 30'
    required: true
    default: '30'


runs:
  using: "composite"
  steps:
    - uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        cache: 'pip'
    - run: pip install -r ${GITHUB_ACTION_PATH}/requirements.txt
    - name: setup kubectl
      run: |
        ${GITHUB_ACTION_PATH}/entrypoint.sh
      shell: bash
      env:
        INPUT_REPOSITORYNAME: ${{inputs.repositoryName}}
        INPUT_IMAGETAGMUTABILITY:  ${{inputs.imageTagMutability}}
        INPUT_TAGS:  ${{inputs.tags}}
        INPUT_TAGSTATUS: ${{inputs.tagStatus}}
        INPUT_COUNTNUMBER: ${{inputs.countNumber}}
        INPUT_COUNTTYPE: ${{inputs.countType}}
